# System design социальной сети для путешественников

## Функциональные требования
- личный кабинет
- публикация постов с дополнительным контентом:
    * фотографии (до 5 штук)
    * описание (до 150 символов)
    * привязка геолокации
- реакции на посты (стандартные лайки и дизлайки)
- комментарии к постам (до 150 символов)
- система подписок с уведомлениями об обновлениях
- поиск по тексту и по геолокации
- просмотр ленты по заданным фильтрам:
    * только подписки
    * по геолокации
    * все подряд

## Нефункциональные требования
- Аудитория приложения
    * DAU - закладываемся на 20_000_000 пользователей, так как планируется постоянный линейный рост
    * Среднестатистическая User story:
        1) 2 поста в день (утро, вечер)
        2) 30 реакций в день
        3) 3 комментария в день
        4) просматривает 100 постов в день
    * Регионы использования - только СНГ
- Особенности приложения
    * Сезонность есть. Так как говорим о странах СНГ, то нужно ожидать повышенную пользовательскую активность с мая по сентябрь и в январе (длительные праздники, летний период отпусков)
    * Данные храним всегда
    * Максимльное количество подписок - 100. Максимальное количество подписчиков - 1_000_000.
    * Доступность приложения 99.95
    * Временные ограничения:
        1) Публикация поста не более 1 секунды
        2) Публикация комментария не более 0.5 секунд
        3) Подгрузка ленты не более 0.1 секунд (тут не знаю, хочется бесшовный вариант организовать, думаю можно заранее подгружать, когда пользователь подскролил до какого-то определенного момента. Или слишком жесткие требования выставляю? могу странные вопросы задавать, у меня опыта проектирования нет вообще)
    * Приложение только для смартфонов

## Оценка нагрузки

- Write
    * Публикация постов (нужно ли тут сокращать dau? все-таки люди больше смотрят, чем постят.):
      ```
      RPS = dau * avg_post_publishing_per_day_by_user / 86_400
      RPS = 20_000_000 * 2 / 86_400 == 470
      ```

      ```
      Traffic
          photo (Будем подгружать картинки 1080 x 1350 px = 1_458_000 px => 1_458_000 bits => 1_458 byte на одну фотографию. Их 5 штук)
          comment (1 char == 3 byte => 150 символов - 450 byte)
          geo (GPS coordinates 8 byte)
      
          traffic = rps * avg_request_size = 470 * (5*1_458 + 450 + 8) = 3_700_000 byte/s = 3_700 kB/s = 3,7 mB/s
      ```
    * Реакции:
      ```
      RPS = dau * avg_reactions_per_day_by_user / 86_400
      RPS = 20_000_000 * 30 / 86_400 == 14_000
      ```

      ```
      Traffic
          reaction (bool - 1 byte)
      
          traffic = rps * avg_request_size = 14_000 * 1 = 14_000 byte/s = 14 kB/s
      ```
    * Комментарии:
      ```
      RPS = dau * avg_comments_publishing_per_day_by_user / 86_400
      RPS = 20_000_000 * 3 / 86_400 == 700
      ```

      ```
      Traffic
          comment (1 char == 3 byte => 150 символов - 450 byte)
  
          traffic = rps * avg_request_size = 700 * 450 = 315_000 byte/s = 315 kB/s
      ```
- Read
    * Скроллинг ленты. Считаем, что за один запрос мы отдаем пользователю 10 постов. Так как в среднем ожидаем, что пользователь просматривает 100 постов, то получается 10 запросов в сутки.
      ```
      RPS = dau * avg_posts_load_per_day_by_user / 86_400
      RPS = 20_000_000 * 10 / 86_400 == 2400
      ```

      ```
      Traffic
          photo (Будем подгружать картинки 1080 x 1350 px = 1_458_000 px => 1_458_000 bits => 1_458 byte на одну фотографию. Их 5 штук)
          comment (1 char == 3 byte => 150 символов - 450 byte)
          geo (GPS coordinates 8 byte)
  
          Подгружаем 100 постов в сутки
          traffic = rps * avg_request_size = 2400 * 100 * (5*1_458 + 450 + 8) = 1,9 gB/s
      ```